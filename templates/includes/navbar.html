{% load static %}

<!-- Top Contact & Social Bar -->
<div class="wrap">
  <div class="container">
    <div class="row">
      <div class="col-md-6 d-flex align-items-center">
        <p class="mb-0 phone pl-md-2">
          <a href="tel:+918125941064" class="mr-2">
            <span class="fa fa-phone mr-1"></span> +91 8125941064
          </a>
          <a href="mailto:shravyavenishetty03@email.com">
            <span class="fa fa-paper-plane mr-1"></span> shravyavenishetty03@email.com
          </a>
        </p>
      </div>
      <div class="col-md-6 d-flex justify-content-md-end">
        <div class="social-media">
          <p class="mb-0 d-flex">
            <a href="#" class="d-flex align-items-center justify-content-center" title="Facebook">
              <span class="fa fa-facebook"></span>
            </a>
            <a href="#" class="d-flex align-items-center justify-content-center" title="Twitter">
              <span class="fa fa-twitter"></span>
            </a>
            <a href="#" class="d-flex align-items-center justify-content-center" title="Instagram">
              <span class="fa fa-instagram"></span>
            </a>
            <a href="#" class="d-flex align-items-center justify-content-center" title="Dribbble">
              <span class="fa fa-dribbble"></span>
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Main Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
  <div class="container">
    <a class="navbar-brand" href="{% url 'home' %}">
      <span class="flaticon-pawprint-1 mr-2"></span>Pawverse
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
            aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="fa fa-bars"></span> Menu
    </button>

    <div class="collapse navbar-collapse" id="ftco-nav">
      <!-- Left: Navigation Links -->
      <ul class="navbar-nav mr-auto">
        <!-- Dropdown Menu -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button"
             data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Menu</a>
          <div class="dropdown-menu" aria-labelledby="pagesDropdown">
            <a class="dropdown-item" href="{% url 'home' %}">Home</a>
            <a class="dropdown-item" href="about.html">About</a>
            <a class="dropdown-item" href="gallery.html">Gallery</a>
            <a class="dropdown-item" href="pricing.html">Pricing</a>
            <a class="dropdown-item" href="blog.html">Blog</a>
            <a class="dropdown-item" href="contact.html">Contact</a>
            <a class="dropdown-item" href="vet.html">Veterinarian</a>
            <a class="dropdown-item" href="{% url 'services:service_list' %}">Services</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="{% url 'shop:store' %}">Pet Store</a>
            <a class="dropdown-item" href="{% url 'shop:all_products' %}">Pet Products</a>
            <a class="dropdown-item" href="{% url 'shop:all_pet_shops' %}">Pet Shops</a>
          </div>
        </li>

        <!-- User Account -->
        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button"
               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="fa fa-user-circle"></i> {{ user.first_name|default:user.username }}
            </a>
            <div class="dropdown-menu" aria-labelledby="accountDropdown">
              <a class="dropdown-item" href="{% url 'accounts:dashboard' %}">Profile</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="{% url 'accounts:logout' %}">Logout</a>
            </div>
          </li>
        {% else %}
          <li class="nav-item"><a href="{% url 'accounts:login' %}" class="nav-link">Sign In</a></li>
          <li class="nav-item"><a href="{% url 'accounts:register' %}" class="nav-link">Sign Up</a></li>
        {% endif %}

        <!-- Cart -->
        <li class="nav-item">
          <a href="{% url 'carts:view' %}" class="nav-link position-relative" title="Cart">
            <span class="fa fa-shopping-cart"></span>
            <span id="cart-count" class="badge badge-pill badge-danger"
                  style="display:{% if cart_item_count %}inline-block{% else %}none{% endif %};
                         position:absolute;top:0;right:-5px;font-size:10px;">
              {{ cart_item_count|default:'' }}
            </span>
          </a>
        </li>

        <!-- Wishlist -->
        <li class="nav-item">
          <a href="{% url 'wishlist:view' %}" class="nav-link position-relative" title="Favourites">
            <span class="fa fa-heart"></span>
            <span id="wishlist-count" class="badge badge-pill badge-danger"
                  style="display:{% if wishlist_item_count %}inline-block{% else %}none{% endif %};
                         position:absolute;top:0;right:-5px;font-size:10px;">
              {{ wishlist_item_count|default:'' }}
            </span>
          </a>
        </li>
      </ul>

      <!-- Navbar Search Form -->
<form method="get" action="{% url 'core:site_search' %}"
      class="navbar-search-form d-flex align-items-center position-relative ml-lg-3 my-md-0 my-2"
      autocomplete="off">
  <input class="form-control search-input" type="search" name="q" id="search-box"
         placeholder="Search entire site..." autocomplete="off"
         value="{{ request.GET.q|default:'' }}" aria-label="Search">
  <button class="btn search-btn" type="submit" tabindex="-1">
    <i class="fa fa-search"></i>
  </button>
  <!-- AJAX suggestions dropdown -->
  <div id="search-suggestions" class="list-group position-absolute w-100"
       style="top:44px; z-index:1000; display:none;"></div>
</form>

    </div>
  </div>
</nav>


<!-- Cart count refresh -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const badge = document.getElementById('cart-count');
    function updateBadge(count) {
      badge.textContent = count > 0 ? count : '';
      badge.style.display = count > 0 ? 'inline-block' : 'none';
    }
    const storedCount = localStorage.getItem('cartItemCount');
    if (storedCount !== null) updateBadge(Number(storedCount));
    fetch("{% url 'carts:cart_count_api' %}")
      .then(res => res.json())
      .then(data => {
        if (data.count !== undefined) {
          updateBadge(data.count);
          localStorage.setItem('cartItemCount', data.count);
        }
      });
  });
</script>

<!-- Search bar styles -->
<style>
  .navbar-search-form {
    background: #fff;
    border: 1.5px solid #ebebeb;
    border-radius: 24px;
    height: 44px;
    min-width: 260px;
    margin-left: 1.2rem;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    transition: border .2s;
  }
  .navbar-search-form:focus-within {
    border: 2px solid #4df34d;
    box-shadow: 0 2px 8px rgba(255,153,0, 0.09);
  }
  .search-input {
    border: none;
    background: transparent;
    font-size: 1rem;
    flex: 1;
    min-width: 170px;
    outline: none;
    padding: 0.65rem 0.9rem 0.65rem 1.1rem;
    border-radius: 24px 0 0 24px;
    box-shadow: none;
  }
  .search-btn {
    background: #4df34d;
    border: none;
    color: #fff;
    padding: 0 1.2rem;
    border-radius: 0 24px 24px 0;
    transition: background 0.17s;
    height: 44px;
    display: flex;
    align-items: center;
    outline: none;
    box-shadow: none;
  }
  .search-btn:hover, .search-btn:focus {
    background: #4df34d;
  }
  #search-suggestions .list-group-item {
    cursor: pointer;
    font-size: 1rem;
    padding: 0.65rem 1.1rem;
  }
  @media (max-width: 991px) {
    .navbar-search-form { min-width: 140px; margin-top: .5rem; }
    .search-input { min-width: 60px; }
  }
</style>

<!-- AJAX Autocomplete -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function(){
  var $input = $("#search-box");
  var $suggestions = $("#search-suggestions");

  $input.on("input", function(){
    var term = $(this).val();
    $suggestions.empty().hide();
    if(term.length > 1) {
      $.getJSON("{% url 'core:autocomplete_search' %}", {term: term}, function(data){
        if(data.length) {
          data.forEach(function(item){
            var $i = $('<a>', {
              class: 'list-group-item list-group-item-action',
              text: item.label,
              href: item.url
            });
            $suggestions.append($i);
          });
          $suggestions.show();
        }
      });
    }
  });

  $(document).on('click', function(e){
    if(!$(e.target).closest('.navbar-search-form').length) {
      $suggestions.hide();
    }
  });
});
</script>

<!-- Font Awesome (make sure in <head> of base.html for icons to work) -->
<!--
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
-->
