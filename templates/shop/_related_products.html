{% load static %}

<div>
  {% if related_products %}
    <div class="d-flex align-items-center mb-3">
      <h4 class="mb-0 font-weight-bold">Related Products</h4>
    </div>
    <div class="related-products-carousel d-flex flex-row flex-nowrap overflow-auto pb-2" tabindex="0" aria-label="Related products carousel">
      {% for product in related_products %}
        <div class="related-product-card" role="group" aria-label="{{ product.name }}">
          <div class="card h-100 shadow-sm border-0">
            <a href="{% url 'shop:product_detail' product.pk %}" class="d-block p-2 pb-0" tabindex="-1" aria-label="View details for {{ product.name }}">
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="card-img-top related-product-img mx-auto" />
            </a>
            <div class="card-body d-flex flex-column pt-1 pb-2 text-center">
              <div class="font-weight-bold small text-truncate mb-1" title="{{ product.name }}">
                {{ product.name }}
              </div>
              <div class="product-description mb-2" title="{{ product.description|default:'No description available' }}">
                {{ product.description|default:"No description available" }}
              </div>
              <div class="text-primary font-weight-bold mb-0" style="font-size:1.10em;">â‚¹ {{ product.price|floatformat:2 }}</div>
              {# Add to Cart button removed as per request #}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-muted py-2 px-3">No related products available.</div>
  {% endif %}
</div>

<style>
.related-products-carousel {
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 10px;
  outline: none;
}

.related-products-carousel::-webkit-scrollbar {
  height: 7px;
}

.related-products-carousel::-webkit-scrollbar-thumb {
  background-color: #e0e0e0;
  border-radius: 10px;
}

/* Reduced spacing between cards for a tight layout */
.related-product-card {
  flex: 0 0 150px;
  max-width: 150px;
  margin-right: 8px;
  display: flex;
}

.related-product-card:last-child {
  margin-right: 0;
}

.card {
  border-radius: 12px;
  min-height: 265px; /* Increased to accommodate description */
  width: 100%;
  display: flex;
  flex-direction: column;
  transition: box-shadow 0.25s ease;
}

.card:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.related-product-img {
  width: 100%;
  max-width: 120px;
  min-width: 100px;
  height: 92px;
  background: #fff;
  border-radius: 6px;
  transition: transform 0.25s ease;
  object-fit: contain;
  display: block;
  margin: 0 auto;
}

.card:hover .related-product-img {
  transform: scale(1.07);
}

.card-body {
  padding: 0.65rem 0.3rem 0.7rem 0.3rem !important;
}

.font-weight-bold.small {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Description styling */
.product-description {
  font-size: 0.85rem;
  color: #666;
  margin-bottom: 0.6rem;
  min-height: 2.4em; /* approx 2 lines */
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.3;
  text-align: left;
  white-space: normal;
  text-overflow: ellipsis;
  word-break: break-word;
  background: transparent;
}

@media (max-width: 600px) {
  .related-product-card {
    flex: 0 0 115px;
    max-width: 115px;
  }
  .related-product-img {
    max-width: 90px;
    height: 68px;
  }
  .card {
    min-height: 210px;
  }
}
</style>
